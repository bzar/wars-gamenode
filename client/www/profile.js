// Generated by CoffeeScript 1.4.0
(function() {

  require(["gamenode", "base"], function() {
    var client, initialize, session;
    client = new GameNodeClient(Skeleton);
    session = null;
    $(document).ready(function() {
      var loginUrl;
      loginUrl = "login.html?next=" + document.location.pathname + document.location.search;
      return session = resumeSessionOrRedirect(client, WARS_CLIENT_SETTINGS.gameServer, loginUrl, function() {
        populateNavigation(session);
        return initialize(client);
      });
    });
    return initialize = function(client) {
      client.stub.profile(function(response) {
        var profile;
        if (!response.success) {
          alert("Unable to get profile! " + response.reason);
        }
        profile = response.profile;
        $("#username").val(profile.username);
        $("#email").val(profile.email);
        $("#theme").val(profile.settings.gameTheme);
        $("#animationSpeed").val(profile.settings.animationSpeed);
        return $("#emailNotifications").prop("checked", profile.settings.emailNotifications);
      });
      return $("#profileForm").submit(function(e) {
        var animationSpeed, email, emailNotifications, gameTheme, password, password1, password2, username;
        e.preventDefault();
        username = $("#username").val();
        email = $("#email").val();
        gameTheme = $("#theme").val();
        animationSpeed = $("#animationSpeed").val();
        emailNotifications = $("#emailNotifications").prop("checked");
        password1 = $("#password").val();
        password2 = $("#password2").val();
        password = (password1 !== password2 || password1 === "" ? null : password1);
        return client.stub.saveProfile(username, password, email, gameTheme, animationSpeed, emailNotifications, function(response) {
          var message;
          if (!response.success) {
            return alert("Unable to get profile! " + response.reason);
          } else {
            message = $("#profileSavedMessage");
            message.show();
            return message.fadeOut(2000);
          }
        });
      });
    };
  });

}).call(this);
